<!DOCTYPE html>
<html xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/eventos.css}">
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <link rel="stylesheet" href="../../static/css/bootstrap.min.css">
  <title>Agenda</title>
</head>

<body style="margin:auto;">

 <div th:replace="~{fragments/_navbar :: nav-painel}"></div>

  <div class="divObjeto" th:data-objeto="${objetoJSON}"></div>

  <div class="container-fluid">
    <div class="row" >
      <div th:replace="~{fragments/_barraLateral :: painel-lateral}"></div>
      <div style="overflow-y: auto;" class="col">

        <div class="row">
          <br>
          <div id="calendar" class="col-1"></div>
          
          <div class="col-2 align-self-center" sec:authorize="hasAuthority('ADMIN')">
            <a th:href="@{/eventos/cadastrar/}" >
              <button class="btn btn-warning">Adicionar Evento</button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div th:replace="~{fragments/_footer :: footer}"></div>
</body>
<script th:src="@{/js/moment.min.js}"></script>
  <script src="../../static/js/moment.min.js"></script>
  <script th:src="@{/js/eventCalendarWidget.min.js}"></script>
  <script src="../../static/js/eventCalendarWidget.min.js"></script>
  <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
  <script src="../../static/js/bootstrap.bundle.min.js"></script>
  <script>
    //resgata a String do documento e à transforma em Objetos Javascript
    const $div = document.querySelector('.divObjeto')
    const stringJSONDoHTML = $div.dataset.objeto
    const objeto = JSON.parse(stringJSONDoHTML)

    //Transforma esses objetos em objetos que o calendário possa ler
    var dataUtil = []
    objeto.forEach(element => {
    var aux = { eventName: element.nome, eventFrom: `${element.data} ${element.horario}:00`, eventTo: `${element.data} 23:59:59`, href: `[[@{/eventos/}]]${element.id}/` }
      dataUtil.push(aux)
    });
    /*
      {
        [
        'eventName' : 'some name',
        'calendar' : 'some label',
        'color' : 'blue','orange','green','yellow','red','coral','purple','lime','black' OR 'aqua'
        'location' : 'any location',
        'eventFrom' : '2020-05-31 17:00:00',
        'eventTo' : '2020-05-31 21:30:00',
        'href' : 'some URL'
        ]
       }
    */

    let calendar = new Calendar("#calendar", dataUtil);

  </script>

</html>